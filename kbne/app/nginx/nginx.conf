# Nginx 配置，用于Web页面伪装和流量分流

events {
    worker_connections 1024;
}

http {
    # 确保Nginx能够找到MIME类型
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    server {
        # 监听容器的外部端口
        listen 7860;
        server_name _; # 匹配所有域名

        # 根路径 (/) 或任何其他非代理路径
        location / {
            # 1. 静态网页伪装：指定静态文件的根目录
            root /app/html;
            index index.html;
            
            # 尝试查找文件，如果找不到，返回404
            try_files $uri $uri/ =404;
        }

        # 代理路径：转发给Xray服务 (请将 /proxy-path 替换为你Xray配置中的实际路径)
        location /b3a053a4 {
            # 2. 流量分流：将请求转发到Xray监听的内部端口
            proxy_redirect off;
            proxy_pass http://127.0.0.1:8080; # Xray内部监听8080端口
           
            # 阻止浏览器缓存代理响应
            add_header Cache-Control "no-cache, no-store, must-revalidate";
        }
    }
}